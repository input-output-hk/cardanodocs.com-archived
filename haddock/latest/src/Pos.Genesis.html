<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-| Blockchain genesis. Not to be confused with genesis block in epoch.
    Blockchain genesis means genesis values which are hardcoded in advance
    (before system starts doing anything). Genesis block in epoch exists
    in every epoch and it's not known in advance.
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Genesis</span><span>
</span><a name="line-8"></a><span>       </span><span class="hs-special">(</span><span>
</span><a name="line-9"></a><span>       </span><span class="hs-comment">-- * Static state</span><span>
</span><a name="line-10"></a><span>         </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.Types.html#GenesisData"><span class="hs-identifier hs-type">GenesisData</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.Types.html#getTotalStake"><span class="hs-identifier hs-var">getTotalStake</span></a><span>
</span><a name="line-13"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.Parser.html#compileGenData"><span class="hs-identifier hs-var">compileGenData</span></a><span>
</span><a name="line-14"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisStakeDistribution"><span class="hs-identifier hs-var">genesisStakeDistribution</span></a><span>
</span><a name="line-15"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisUtxo"><span class="hs-identifier hs-var">genesisUtxo</span></a><span>
</span><a name="line-16"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisDelegation"><span class="hs-identifier hs-var">genesisDelegation</span></a><span>
</span><a name="line-17"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisAddresses"><span class="hs-identifier hs-var">genesisAddresses</span></a><span>
</span><a name="line-18"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">genesisSeed</span><span>
</span><a name="line-19"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisBalances"><span class="hs-identifier hs-var">genesisBalances</span></a><span>
</span><a name="line-20"></a><span>       </span><span class="hs-comment">-- ** Genesis data used in development mode</span><span>
</span><a name="line-21"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisDevKeyPairs"><span class="hs-identifier hs-var">genesisDevKeyPairs</span></a><span>
</span><a name="line-22"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisDevPublicKeys"><span class="hs-identifier hs-var">genesisDevPublicKeys</span></a><span>
</span><a name="line-23"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisDevSecretKeys"><span class="hs-identifier hs-var">genesisDevSecretKeys</span></a><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>       </span><span class="hs-comment">-- * Ssc</span><span>
</span><a name="line-26"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.html#genesisLeaders"><span class="hs-identifier hs-var">genesisLeaders</span></a><span>
</span><a name="line-27"></a><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Default</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Default</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericLength</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">genericReplicate</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span class="hs-operator">.</span><span class="hs-identifier">Strict</span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Formatting</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sformat</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">%</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Serokell</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">enumerate</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Universum</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Pos.Constants.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Constants</span></a><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Const</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">StakeholderId</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Crypto</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PublicKey</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SecretKey</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">deterministicKeyGen</span><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>                                     </span><span class="hs-identifier hs-var">unsafeHash</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Genesis.Parser.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Genesis</span><span class="hs-operator">.</span><span class="hs-identifier">Parser</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Parser.html#compileGenData"><span class="hs-identifier hs-var">compileGenData</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Genesis.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Genesis</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>  </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#GenesisData"><span class="hs-identifier hs-type">GenesisData</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>                                     </span><a href="Pos.Genesis.Types.html#getTotalStake"><span class="hs-identifier hs-var">getTotalStake</span></a><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Lrc.FtsPure.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Lrc</span><span class="hs-operator">.</span><span class="hs-identifier">FtsPure</span></a><span>    </span><span class="hs-special">(</span><a href="Pos.Lrc.FtsPure.html#followTheSatoshi"><span class="hs-identifier hs-var">followTheSatoshi</span></a><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Lrc</span><span class="hs-operator">.</span><span class="hs-identifier">Genesis</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genesisSeed</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Txp.Core.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Txp</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Txp.Core.Types.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pos.Txp.Core.Types.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pos.Txp.Core.Types.html#TxOutAux"><span class="hs-identifier hs-type">TxOutAux</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>                                     </span><a href="Pos.Txp.Core.Types.html#TxOutDistribution"><span class="hs-identifier hs-type">TxOutDistribution</span></a><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Txp.Toil.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Txp</span><span class="hs-operator">.</span><span class="hs-identifier">Toil</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Txp.Toil.Types.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><a href="Pos.Types.html"><span class="hs-identifier">Pos</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Address</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SlotLeaders</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">applyCoinPortion</span><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>                                     </span><span class="hs-identifier hs-var">coinToInteger</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">divCoin</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">makePubKeyAddress</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkCoin</span><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>                                     </span><span class="hs-identifier hs-var">unsafeAddCoin</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unsafeMulCoin</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- Static state</span><span>
</span><a name="line-55"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-identifier">generateGenesisKeyPair</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PublicKey</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SecretKey</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><a name="generateGenesisKeyPair"><a href="Pos.Genesis.html#generateGenesisKeyPair"><span class="hs-identifier">generateGenesisKeyPair</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;deterministicKeyGen failed in Genesis&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-identifier hs-var">deterministicKeyGen</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-identifier hs-var">encodeUtf8</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-identifier hs-var">T</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">32</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sformat</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;My awesome 32-byte seed #&quot;</span><span> </span><span class="hs-operator hs-var">%</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">%</span><span> </span><span class="hs-string">&quot;             &quot;</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">-- | List of pairs from 'SecretKey' with corresponding 'PublicKey'.</span><span>
</span><a name="line-65"></a><span class="hs-identifier">genesisDevKeyPairs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">PublicKey</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SecretKey</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-66"></a><a name="genesisDevKeyPairs"><a href="Pos.Genesis.html#genesisDevKeyPairs"><span class="hs-identifier">genesisDevKeyPairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Pos.Genesis.html#generateGenesisKeyPair"><span class="hs-identifier hs-var">generateGenesisKeyPair</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="Pos.Constants.html#genesisN"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisN</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | List of 'PublicKey's in genesis.</span><span>
</span><a name="line-69"></a><span class="hs-identifier">genesisDevPublicKeys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">PublicKey</span><span class="hs-special">]</span><span>
</span><a name="line-70"></a><a name="genesisDevPublicKeys"><a href="Pos.Genesis.html#genesisDevPublicKeys"><span class="hs-identifier">genesisDevPublicKeys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="Pos.Genesis.html#genesisDevKeyPairs"><span class="hs-identifier hs-var">genesisDevKeyPairs</span></a><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">-- | List of 'SecretKey's in genesis.</span><span>
</span><a name="line-73"></a><span class="hs-identifier">genesisDevSecretKeys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SecretKey</span><span class="hs-special">]</span><span>
</span><a name="line-74"></a><a name="genesisDevSecretKeys"><a href="Pos.Genesis.html#genesisDevSecretKeys"><span class="hs-identifier">genesisDevSecretKeys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="Pos.Genesis.html#genesisDevKeyPairs"><span class="hs-identifier hs-var">genesisDevKeyPairs</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-comment">-- | List of addresses in genesis. See 'genesisPublicKeys'.</span><span>
</span><a name="line-77"></a><span class="hs-identifier">genesisAddresses</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Address</span><span class="hs-special">]</span><span>
</span><a name="line-78"></a><a name="genesisAddresses"><a href="Pos.Genesis.html#genesisAddresses"><span class="hs-identifier">genesisAddresses</span></a></a><span>
</span><a name="line-79"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isDevelopment</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">makePubKeyAddress</span><span> </span><a href="Pos.Genesis.html#genesisDevPublicKeys"><span class="hs-identifier hs-var">genesisDevPublicKeys</span></a><span>
</span><a name="line-80"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gdAddresses</span><span> </span><a href="Pos.Genesis.Parser.html#compileGenData"><span class="hs-identifier hs-var">compileGenData</span></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-identifier">genesisStakeDistribution</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span>
</span><a name="line-83"></a><a name="genesisStakeDistribution"><a href="Pos.Genesis.html#genesisStakeDistribution"><span class="hs-identifier">genesisStakeDistribution</span></a></a><span>
</span><a name="line-84"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isDevelopment</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">def</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gdDistribution</span><span> </span><a href="Pos.Genesis.Parser.html#compileGenData"><span class="hs-identifier hs-var">compileGenData</span></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-identifier">genesisBalances</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HashMap</span><span> </span><span class="hs-identifier hs-type">StakeholderId</span><span> </span><span class="hs-identifier hs-type">Coin</span><span>
</span><a name="line-88"></a><a name="genesisBalances"><a href="Pos.Genesis.html#genesisBalances"><span class="hs-identifier">genesisBalances</span></a></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isDevelopment</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gdBootstrapBalances</span><span> </span><a href="Pos.Genesis.Parser.html#compileGenData"><span class="hs-identifier hs-var">compileGenData</span></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Default</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-93"></a><span>    </span><a name="local-8214565720323792773"><span class="hs-identifier">def</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Genesis.Types.html#FlatStakes"><span class="hs-identifier hs-var">FlatStakes</span></a><span> </span><a href="Pos.Constants.html#genesisN"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisN</span></a><span>
</span><a name="line-94"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCoin</span><span> </span><span class="hs-number">10000</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeMulCoin</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Pos.Constants.html#genesisN"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisN</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-comment">-- 10000 coins in total. For thresholds testing.</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- 0.5,0.25,0.125,0.0625,0.0312,0.0156,0.0078,0.0039,0.0019,0.0008,0.0006,0.0004,0.0002,0.0001</span><span>
</span><a name="line-98"></a><span class="hs-identifier">expTwoDistribution</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-99"></a><a name="expTwoDistribution"><a href="Pos.Genesis.html#expTwoDistribution"><span class="hs-identifier">expTwoDistribution</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">mkCoin</span><span> </span><span class="hs-special">[</span><span class="hs-number">5000</span><span class="hs-special">,</span><span class="hs-number">2500</span><span class="hs-special">,</span><span class="hs-number">1250</span><span class="hs-special">,</span><span class="hs-number">625</span><span class="hs-special">,</span><span class="hs-number">312</span><span class="hs-special">,</span><span class="hs-number">156</span><span class="hs-special">,</span><span class="hs-number">78</span><span class="hs-special">,</span><span class="hs-number">39</span><span class="hs-special">,</span><span class="hs-number">19</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">,</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-identifier">bitcoinDistribution20</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-103"></a><a name="bitcoinDistribution20"><a href="Pos.Genesis.html#bitcoinDistribution20"><span class="hs-identifier">bitcoinDistribution20</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">mkCoin</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-special">[</span><span class="hs-number">200</span><span class="hs-special">,</span><span class="hs-number">163</span><span class="hs-special">,</span><span class="hs-number">120</span><span class="hs-special">,</span><span class="hs-number">105</span><span class="hs-special">,</span><span class="hs-number">78</span><span class="hs-special">,</span><span class="hs-number">76</span><span class="hs-special">,</span><span class="hs-number">57</span><span class="hs-special">,</span><span class="hs-number">50</span><span class="hs-special">,</span><span class="hs-number">46</span><span class="hs-special">,</span><span class="hs-number">31</span><span class="hs-special">,</span><span class="hs-number">26</span><span class="hs-special">,</span><span class="hs-number">13</span><span class="hs-special">,</span><span class="hs-number">11</span><span class="hs-special">,</span><span class="hs-number">11</span><span class="hs-special">,</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">]</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-identifier">stakeDistribution</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">,</span><span> </span><a href="Pos.Txp.Core.Types.html#TxOutDistribution"><span class="hs-identifier hs-type">TxOutDistribution</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-107"></a><a name="stakeDistribution"><a href="Pos.Genesis.html#stakeDistribution"><span class="hs-identifier">stakeDistribution</span></a></a><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#FlatStakes"><span class="hs-identifier hs-var">FlatStakes</span></a><span> </span><a name="local-6989586621679910541"><a href="#local-6989586621679910541"><span class="hs-identifier">stakeholders</span></a></a><span> </span><a name="local-6989586621679910542"><a href="#local-6989586621679910542"><span class="hs-identifier">coins</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-identifier hs-var">genericReplicate</span><span> </span><a href="#local-6989586621679910541"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><a href="#local-6989586621679910543"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-109"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-110"></a><span>    </span><a name="local-6989586621679910543"><a href="#local-6989586621679910543"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679910542"><span class="hs-identifier hs-var">coins</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divCoin</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679910541"><span class="hs-identifier hs-var">stakeholders</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span class="hs-identifier">stakeDistribution</span><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#BitcoinStakes"><span class="hs-identifier hs-var">BitcoinStakes</span></a><span> </span><a name="local-6989586621679910544"><a href="#local-6989586621679910544"><span class="hs-identifier">stakeholders</span></a></a><span> </span><a name="local-6989586621679910545"><a href="#local-6989586621679910545"><span class="hs-identifier">coins</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679910546"><span class="hs-identifier hs-var">normalize</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Pos.Genesis.html#bitcoinDistribution1000Coins"><span class="hs-identifier hs-var">bitcoinDistribution1000Coins</span></a><span> </span><a href="#local-6989586621679910544"><span class="hs-identifier hs-var">stakeholders</span></a><span>
</span><a name="line-113"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-114"></a><span>    </span><a name="local-6989586621679910546"><a href="#local-6989586621679910546"><span class="hs-identifier">normalize</span></a></a><span> </span><a name="local-6989586621679910547"><a href="#local-6989586621679910547"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679910547"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeMulCoin</span><span class="hs-special">`</span><span>
</span><a name="line-115"></a><span>                  </span><span class="hs-identifier hs-var">coinToInteger</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679910545"><span class="hs-identifier hs-var">coins</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divCoin</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-number">1000</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span class="hs-identifier">stakeDistribution</span><span> </span><a href="Pos.Genesis.Types.html#ExponentialStakes"><span class="hs-identifier hs-var">ExponentialStakes</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="Pos.Genesis.html#expTwoDistribution"><span class="hs-identifier hs-var">expTwoDistribution</span></a><span>
</span><a name="line-117"></a><span class="hs-identifier">stakeDistribution</span><span> </span><a name="local-6989586621679910548"><a href="#local-6989586621679910548"><span class="hs-identifier">ts</span></a></a><span class="hs-glyph">@</span><a href="Pos.Genesis.Types.html#RichPoorStakes"><span class="hs-identifier hs-var">RichPoorStakes</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-118"></a><span>    </span><a href="#local-6989586621679910553"><span class="hs-identifier hs-var">checkMpcThd</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#getTotalStake"><span class="hs-identifier hs-var">getTotalStake</span></a><span> </span><a href="#local-6989586621679910548"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679910550"><span class="hs-identifier hs-var">sdRichStake</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679910554"><span class="hs-identifier hs-var">basicDist</span></a><span>
</span><a name="line-120"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-comment">-- Node won't start if richmen cannot participate in MPC</span><span>
</span><a name="line-122"></a><span>    </span><a name="local-6989586621679910553"><a href="#local-6989586621679910553"><span class="hs-identifier">checkMpcThd</span></a></a><span> </span><a name="local-6989586621679910555"><a href="#local-6989586621679910555"><span class="hs-identifier">total</span></a></a><span> </span><a name="local-6989586621679910556"><a href="#local-6989586621679910556"><span class="hs-identifier">richs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-123"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679910556"><span class="hs-identifier hs-var">richs</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier hs-var">applyCoinPortion</span><span> </span><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisMpcThd</span><span> </span><a href="#local-6989586621679910555"><span class="hs-identifier hs-var">total</span></a><span>
</span><a name="line-124"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Pos.Genesis: RichPoorStakes: richmen stake \
                   \is less than MPC threshold&quot;</span><span>
</span><a name="line-126"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">identity</span><span>
</span><a name="line-127"></a><span>    </span><a name="local-6989586621679910554"><a href="#local-6989586621679910554"><span class="hs-identifier">basicDist</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">genericReplicate</span><span> </span><a href="#local-6989586621679910549"><span class="hs-identifier hs-var">sdRichmen</span></a><span> </span><a href="#local-6989586621679910550"><span class="hs-identifier hs-var">sdRichStake</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-128"></a><span>                </span><span class="hs-identifier hs-var">genericReplicate</span><span> </span><a href="#local-6989586621679910551"><span class="hs-identifier hs-var">sdPoor</span></a><span> </span><a href="#local-6989586621679910552"><span class="hs-identifier hs-var">sdPoorStake</span></a><span>
</span><a name="line-129"></a><span class="hs-identifier">stakeDistribution</span><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#ExplicitStakes"><span class="hs-identifier hs-var">ExplicitStakes</span></a><span> </span><a name="local-6989586621679910557"><a href="#local-6989586621679910557"><span class="hs-identifier">balances</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-130"></a><span>    </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679910557"><span class="hs-identifier hs-var">balances</span></a><span>
</span><a name="line-131"></a><span class="hs-identifier">stakeDistribution</span><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#CombinedStakes"><span class="hs-identifier hs-var">CombinedStakes</span></a><span> </span><a name="local-6989586621679910558"><a href="#local-6989586621679910558"><span class="hs-identifier">distA</span></a></a><span> </span><a name="local-6989586621679910559"><a href="#local-6989586621679910559"><span class="hs-identifier">distB</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-132"></a><span>    </span><a href="Pos.Genesis.html#stakeDistribution"><span class="hs-identifier hs-var">stakeDistribution</span></a><span> </span><a href="#local-6989586621679910558"><span class="hs-identifier hs-var">distA</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Pos.Genesis.html#stakeDistribution"><span class="hs-identifier hs-var">stakeDistribution</span></a><span> </span><a href="#local-6989586621679910559"><span class="hs-identifier hs-var">distB</span></a><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-identifier">bitcoinDistribution1000Coins</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-135"></a><a name="bitcoinDistribution1000Coins"><a href="Pos.Genesis.html#bitcoinDistribution1000Coins"><span class="hs-identifier">bitcoinDistribution1000Coins</span></a></a><span> </span><a name="local-6989586621679910560"><a href="#local-6989586621679910560"><span class="hs-identifier">stakeholders</span></a></a><span>
</span><a name="line-136"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679910560"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">20</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Pos.Genesis.html#stakeDistribution"><span class="hs-identifier hs-var">stakeDistribution</span></a><span>
</span><a name="line-137"></a><span>          </span><span class="hs-special">(</span><a href="Pos.Genesis.Types.html#FlatStakes"><span class="hs-identifier hs-var">FlatStakes</span></a><span> </span><a href="#local-6989586621679910560"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCoin</span><span> </span><span class="hs-number">1000</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679910560"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">20</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Genesis.html#bitcoinDistribution20"><span class="hs-identifier hs-var">bitcoinDistribution20</span></a><span>
</span><a name="line-139"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-140"></a><span>        </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.html#bitcoinDistributionImpl"><span class="hs-identifier hs-var">bitcoinDistributionImpl</span></a><span> </span><a href="#local-6989586621679910561"><span class="hs-identifier hs-var">ratio</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-141"></a><span>        </span><span class="hs-identifier hs-var">enumerate</span><span> </span><a href="Pos.Genesis.html#bitcoinDistribution20"><span class="hs-identifier hs-var">bitcoinDistribution20</span></a><span>
</span><a name="line-142"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-143"></a><span>    </span><a name="local-6989586621679910561"><a href="#local-6989586621679910561"><span class="hs-identifier">ratio</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679910560"><span class="hs-identifier hs-var">stakeholders</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-number">20</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-identifier">bitcoinDistributionImpl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Coin</span><span class="hs-special">]</span><span>
</span><a name="line-146"></a><a name="bitcoinDistributionImpl"><a href="Pos.Genesis.html#bitcoinDistributionImpl"><span class="hs-identifier">bitcoinDistributionImpl</span></a></a><span> </span><a name="local-6989586621679910562"><a href="#local-6989586621679910562"><span class="hs-identifier">ratio</span></a></a><span> </span><a name="local-6989586621679910563"><a href="#local-6989586621679910563"><span class="hs-identifier">coins</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679910564"><a href="#local-6989586621679910564"><span class="hs-identifier">coinIdx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679910565"><a href="#local-6989586621679910565"><span class="hs-identifier">coin</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-147"></a><span>    </span><a href="#local-6989586621679910563"><span class="hs-identifier hs-var">coins</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679910570"><span class="hs-identifier hs-var">toAddValMax</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679910568"><span class="hs-identifier hs-var">toAddNum</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679910569"><span class="hs-identifier hs-var">toAddValMin</span></a><span>
</span><a name="line-148"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-149"></a><span>    </span><a name="local-6989586621679910566"><a href="#local-6989586621679910566"><span class="hs-identifier">toAddNumMax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ceiling</span><span> </span><a href="#local-6989586621679910562"><span class="hs-identifier hs-var">ratio</span></a><span>
</span><a name="line-150"></a><span>    </span><a name="local-6989586621679910567"><a href="#local-6989586621679910567"><span class="hs-identifier">toAddNumMin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">floor</span><span> </span><a href="#local-6989586621679910562"><span class="hs-identifier hs-var">ratio</span></a><span>
</span><a name="line-151"></a><span>    </span><span class="hs-identifier">toAddNum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-152"></a><span>    </span><a name="local-6989586621679910568"><a href="#local-6989586621679910568"><span class="hs-identifier">toAddNum</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-153"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">genericLength</span><span> </span><a href="#local-6989586621679910563"><span class="hs-identifier hs-var">coins</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">realToFrac</span><span> </span><a href="#local-6989586621679910566"><span class="hs-identifier hs-var">toAddNumMax</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span>
</span><a name="line-154"></a><span>           </span><span class="hs-identifier hs-var">realToFrac</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679910564"><span class="hs-identifier hs-var">coinIdx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679910562"><span class="hs-identifier hs-var">ratio</span></a><span>
</span><a name="line-155"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679910567"><span class="hs-identifier hs-var">toAddNumMin</span></a><span>
</span><a name="line-156"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679910566"><span class="hs-identifier hs-var">toAddNumMax</span></a><span>
</span><a name="line-157"></a><span>    </span><a name="local-6989586621679910569"><a href="#local-6989586621679910569"><span class="hs-identifier">toAddValMin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679910565"><span class="hs-identifier hs-var">coin</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divCoin</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679910568"><span class="hs-identifier hs-var">toAddNum</span></a><span>
</span><a name="line-158"></a><span>    </span><a name="local-6989586621679910570"><a href="#local-6989586621679910570"><span class="hs-identifier">toAddValMax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679910565"><span class="hs-identifier hs-var">coin</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeAddCoin</span><span class="hs-special">`</span><span>
</span><a name="line-159"></a><span>                  </span><span class="hs-special">(</span><a href="#local-6989586621679910569"><span class="hs-identifier hs-var">toAddValMin</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeMulCoin</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679910568"><span class="hs-identifier hs-var">toAddNum</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- | Genesis 'Utxo'.</span><span>
</span><a name="line-162"></a><span class="hs-identifier">genesisUtxo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Genesis.Types.html#StakeDistribution"><span class="hs-identifier hs-type">StakeDistribution</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pos.Txp.Toil.Types.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a><span>
</span><a name="line-163"></a><a name="genesisUtxo"><a href="Pos.Genesis.html#genesisUtxo"><span class="hs-identifier">genesisUtxo</span></a></a><span> </span><a name="local-6989586621679910571"><a href="#local-6989586621679910571"><span class="hs-identifier">sd</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621679910572"><span class="hs-identifier hs-var">zipF</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Genesis.html#stakeDistribution"><span class="hs-identifier hs-var">stakeDistribution</span></a><span> </span><a href="#local-6989586621679910571"><span class="hs-identifier hs-var">sd</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-165"></a><span>    </span><a href="Pos.Genesis.html#genesisAddresses"><span class="hs-identifier hs-var">genesisAddresses</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679910573"><span class="hs-identifier hs-var">tailAddresses</span></a><span>
</span><a name="line-166"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-167"></a><span>    </span><a name="local-6989586621679910572"><a href="#local-6989586621679910572"><span class="hs-identifier">zipF</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679910574"><a href="#local-6989586621679910574"><span class="hs-identifier">coin</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679910575"><a href="#local-6989586621679910575"><span class="hs-identifier">distr</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679910576"><a href="#local-6989586621679910576"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-168"></a><span>        </span><span class="hs-special">(</span><span> </span><a href="Pos.Txp.Core.Types.html#TxIn"><span class="hs-identifier hs-var">TxIn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeHash</span><span> </span><a href="#local-6989586621679910576"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-169"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Pos.Txp.Core.Types.html#TxOutAux"><span class="hs-identifier hs-var">TxOutAux</span></a><span> </span><span class="hs-special">(</span><a href="Pos.Txp.Core.Types.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a><span> </span><a href="#local-6989586621679910576"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621679910574"><span class="hs-identifier hs-var">coin</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679910575"><span class="hs-identifier hs-var">distr</span></a><span>
</span><a name="line-170"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>    </span><a name="local-6989586621679910573"><a href="#local-6989586621679910573"><span class="hs-identifier">tailAddresses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">makePubKeyAddress</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Pos.Genesis.html#generateGenesisKeyPair"><span class="hs-identifier hs-var">generateGenesisKeyPair</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>        </span><span class="hs-special">[</span><a href="Pos.Constants.html#genesisN"><span class="hs-identifier hs-var">Const</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genesisN</span></a><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">genesisDelegation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HashMap</span><span> </span><span class="hs-identifier hs-type">StakeholderId</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">StakeholderId</span><span class="hs-special">]</span><span>
</span><a name="line-175"></a><a name="genesisDelegation"><a href="Pos.Genesis.html#genesisDelegation"><span class="hs-identifier">genesisDelegation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- Slot leaders</span><span>
</span><a name="line-179"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- | Leaders of genesis. See 'followTheSatoshi'.</span><span>
</span><a name="line-182"></a><span class="hs-identifier">genesisLeaders</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pos.Txp.Toil.Types.html#Utxo"><span class="hs-identifier hs-type">Utxo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SlotLeaders</span><span>
</span><a name="line-183"></a><a name="genesisLeaders"><a href="Pos.Genesis.html#genesisLeaders"><span class="hs-identifier">genesisLeaders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pos.Lrc.FtsPure.html#followTheSatoshi"><span class="hs-identifier hs-var">followTheSatoshi</span></a><span> </span><span class="hs-identifier hs-var">genesisSeed</span><span>
</span><a name="line-184"></a></pre></body></html>